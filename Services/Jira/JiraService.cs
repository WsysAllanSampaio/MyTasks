using System.Collections.Generic;
using System.Text;

namespace MyTasks.Services.Jira;

public class JiraService
{
    private const string GetCurrentTaskRoute = "https://wsys.atlassian.net/rest/gira/1/?operation=JWMListViewItems";

    public async Task GetCurrentTask(HttpClient Https)
    {
        try
        {
            var Http = new HttpClient();
            var request = new HttpRequestMessage(HttpMethod.Post, GetCurrentTaskRoute);

            var requestBody = new RequestBody
            {
                OperationName = "JWMListViewItems",
                Variables = new()
                {
                    CloudId = "ca2c7326-90f3-4a94-a85d-58876fad9ab0",
                    Jql = "project = 'DEV' AND (status = \"Em Execução\" AND assignee = \"712020:fe1eeeb2-6c9d-47a0-9e9a-549caa8dcd26\") ORDER BY Rank ASC",
                    First = 25,
                    FieldIds = [
                        "issuekey", 
                        "issuetype", 
                        "summary", 
                        "status", 
                        "assignee",
                        "reporter", 
                        "rank", 
                        "parent"
                    ],
                    WithConfluenceLinks = false,
                    IncludeDoneItems = true,
                    IsParentFieldVisible = false,
                    IsDevSummaryFieldVisible = false
                },
                Query = "query JWMListViewItems($cloudId: ID!, $jql: String!, $includeDoneItems: Boolean!, $fieldIds: [String]!, $first: Int, $after: String, $withConfluenceLinks: Boolean!, $isParentFieldVisible: Boolean!, $isDevSummaryFieldVisible: Boolean!) {\n  jira {\n    list: jwmViewItems(cloudId: $cloudId, jql: $jql, first: $first, after: $after) {\n      ... on QueryError {\n        message\n        extensions {\n          statusCode\n          errorType\n          __typename\n        }\n        __typename\n      }\n      ... on JiraWorkManagementViewItemConnection {\n        ...ListViewItemEdges\n        pageInfo {\n          hasNextPage\n          endCursor\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment ListViewItemEdges on JiraWorkManagementViewItemConnection {\n  edges {\n    node {\n      id\n      issueId\n      childSummary(includeDone: $includeDoneItems) {\n        hasChildren\n        totalCount\n        __typename\n      }\n      commentSummary {\n        totalCount\n        __typename\n      }\n      legacyConfluenceLinks(getFirstOnly: true) @include(if: $withConfluenceLinks) {\n        ...ConfluenceLinksFragment\n        __typename\n      }\n      devSummaryCache @include(if: $isDevSummaryFieldVisible) {\n        ...DevSummaryFieldFragment\n        __typename\n      }\n      ...ListViewIssueFieldsFragment\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment ListViewIssueFieldsFragment on JiraWorkManagementViewItem {\n  fields: fieldsByIdOrAlias(idsOrAliases: $fieldIds, ignoreMissingFields: true) {\n    fieldId\n    name\n    aliasFieldId\n    type\n    ... on JiraIssueTypeField {\n      issueType {\n        issueTypeId\n        name\n        avatar {\n          medium\n          __typename\n        }\n        hierarchy {\n          level\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    ... on JiraStatusField {\n      status {\n        name\n        statusId\n        statusCategory {\n          statusCategoryId\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    ... on JiraRichTextField {\n      richText {\n        adfValue {\n          json\n          convertedPlainText {\n            plainText\n            isTruncated\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      renderer\n      __typename\n    }\n    ... on JiraOriginalTimeEstimateField {\n      originalEstimate {\n        timeInSeconds\n        __typename\n      }\n      fieldConfig {\n        isEditable\n        __typename\n      }\n      __typename\n    }\n    ... on JiraTimeTrackingField {\n      originalEstimate {\n        timeInSeconds\n        __typename\n      }\n      timeTrackingSettings {\n        defaultUnit\n        defaultFormat\n        workingHoursPerDay\n        workingDaysPerWeek\n        __typename\n      }\n      __typename\n    }\n    ... on JiraComponentsField {\n      fieldConfig {\n        isEditable\n        __typename\n      }\n      selectedComponentsConnection {\n        edges {\n          node {\n            name\n            componentId\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    ... on JiraParentIssueField {\n      parentIssue {\n        issueId\n        key\n        __typename\n      }\n      __typename\n    }\n    ... on JiraCheckboxesField {\n      selectedOptions {\n        edges {\n          node {\n            optionId\n            value\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    ... on JiraSprintField {\n      fieldId\n      aliasFieldId\n      fieldConfig {\n        isEditable\n        __typename\n      }\n      selectedSprintsConnection(first: 1) {\n        edges {\n          node {\n            sprintId\n            name\n            state\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    ...jiraBusinessSingleVersionFieldFragment\n    ...jiraBusinessMultipleVersionFieldFragment\n    ...jiraBusinessParentFieldFragment\n    ...jiraBusinessTeamFieldFragment\n    ...JiraGoalsFieldFragment\n    ...jiraBusinessResolutionFieldFragment\n    ...jiraBusinessSingleGroupFieldFragment\n    ...jiraBusinessMultipleGroupFieldFragment\n    ...jiraLabelsFieldFragment\n    ...jiraDateFieldFragment\n    ...jiraDateTimeFieldFragment\n    ...jiraSingleUserFieldFragment\n    ...jiraMultipleUserFieldFragment\n    ...jiraPeopleFieldFragment\n    ...jiraPriorityFieldFragment\n    ...jiraMultipleSelectFieldFragment\n    ...jiraNumberFieldFragment\n    ...jiraRadioSelectFieldFragment\n    ...jiraSingleSelectFragment\n    ...jiraUrlFieldFragment\n    ...jiraSingleLineTextFragment\n    ...jiraStatusCategoryFragment\n    ...jiraCascadingSelectFieldFragment\n    ...jiraProjectFieldFragment\n    __typename\n  }\n  __typename\n}\n\nfragment jiraBusinessParentFieldFragment on JiraParentIssueField {\n  fieldId\n  parentIssue {\n    id\n    issueId\n    key\n    rankField: fieldsByIdOrAlias(idsOrAliases: [\"rank\"], ignoreMissingFields: true) {\n      aliasFieldId\n      ... on JiraSingleLineTextField {\n        text\n        __typename\n      }\n      __typename\n    }\n    fields: fieldsByIdOrAlias(\n      idsOrAliases: [\"summary\", \"issuetype\", \"issuecolor\", \"status\"]\n      ignoreMissingFields: true\n    ) @include(if: $isParentFieldVisible) {\n      fieldId\n      name\n      aliasFieldId\n      type\n      ... on JiraColorField {\n        color {\n          colorKey\n          __typename\n        }\n        __typename\n      }\n      ... on JiraSingleLineTextField {\n        text\n        __typename\n      }\n      ... on JiraStatusField {\n        status {\n          name\n          statusCategory {\n            statusCategoryId\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      ... on JiraIssueTypeField {\n        issueType {\n          name\n          avatar {\n            medium\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment jiraBusinessMultipleVersionFieldFragment on JiraMultipleVersionPickerField {\n  __typename\n  id\n  fieldId\n  name\n  selectedVersionsConnection {\n    edges {\n      node {\n        versionId\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment jiraBusinessSingleVersionFieldFragment on JiraSingleVersionPickerField {\n  __typename\n  id\n  fieldId\n  name\n  version {\n    versionId\n    name\n    __typename\n  }\n}\n\nfragment jiraBusinessTeamFieldFragment on JiraTeamViewField {\n  fieldId\n  selectedTeam {\n    jiraSuppliedName\n    jiraSuppliedTeamId\n    __typename\n  }\n  __typename\n}\n\nfragment JiraGoalsFieldFragment on JiraGoalsField {\n  __typename\n  fieldId\n  name\n  fieldConfig {\n    isEditable\n    __typename\n  }\n  selectedGoals(first: 1) {\n    totalCount\n    edges {\n      node {\n        id\n        name\n        status\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment jiraBusinessResolutionFieldFragment on JiraResolutionField {\n  fieldId\n  name\n  resolution {\n    id\n    name\n    __typename\n  }\n  __typename\n}\n\nfragment jiraBusinessMultipleGroupFieldFragment on JiraMultipleGroupPickerField {\n  __typename\n  id\n  fieldId\n  name\n  selectedGroupsConnection {\n    edges {\n      node {\n        id\n        groupId\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment jiraBusinessSingleGroupFieldFragment on JiraSingleGroupPickerField {\n  __typename\n  id\n  fieldId\n  name\n  selectedGroup {\n    id\n    groupId\n    name\n    __typename\n  }\n}\n\nfragment jiraLabelsFieldFragment on JiraLabelsField {\n  selectedLabelsConnection {\n    edges {\n      node {\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment jiraDateFieldFragment on JiraDatePickerField {\n  date\n  __typename\n}\n\nfragment jiraDateTimeFieldFragment on JiraDateTimePickerField {\n  dateTime\n  __typename\n}\n\nfragment AtlassianAccountFragment on AtlassianAccountUser {\n  accountId\n  accountStatus\n  picture\n  name\n  __typename\n}\n\nfragment jiraSingleUserFieldFragment on JiraSingleSelectUserPickerField {\n  user {\n    ...AtlassianAccountFragment\n    __typename\n  }\n  fieldConfig {\n    isEditable\n    __typename\n  }\n  __typename\n}\n\nfragment jiraPeopleFieldFragment on JiraPeopleField {\n  fieldConfig {\n    isEditable\n    __typename\n  }\n  selectedUsersConnection {\n    edges {\n      node {\n        ...AtlassianAccountFragment\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment jiraMultipleUserFieldFragment on JiraMultipleSelectUserPickerField {\n  selectedUsersConnection {\n    edges {\n      node {\n        ...AtlassianAccountFragment\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  fieldConfig {\n    isEditable\n    __typename\n  }\n  __typename\n}\n\nfragment jiraPriorityFieldFragment on JiraPriorityField {\n  priority {\n    id\n    name\n    priorityId\n    iconUrl\n    __typename\n  }\n  __typename\n}\n\nfragment jiraMultipleSelectFieldFragment on JiraMultipleSelectField {\n  fieldConfig {\n    isEditable\n    __typename\n  }\n  selectedOptions {\n    edges {\n      node {\n        optionId\n        value\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment jiraNumberFieldFragment on JiraNumberField {\n  number\n  fieldConfig {\n    isEditable\n    __typename\n  }\n  __typename\n}\n\nfragment jiraRadioSelectFieldFragment on JiraRadioSelectField {\n  fieldId\n  name\n  fieldConfig {\n    isEditable\n    __typename\n  }\n  selectedOption {\n    optionId\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment jiraSingleSelectFragment on JiraSingleSelectField {\n  fieldConfig {\n    isEditable\n    __typename\n  }\n  fieldOption {\n    optionId\n    value\n    color {\n      colorKey\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment jiraUrlFieldFragment on JiraUrlField {\n  uri\n  fieldConfig {\n    isEditable\n    __typename\n  }\n  __typename\n}\n\nfragment jiraSingleLineTextFragment on JiraSingleLineTextField {\n  text\n  __typename\n}\n\nfragment jiraStatusCategoryFragment on JiraStatusCategoryField {\n  fieldId\n  fieldConfig {\n    isEditable\n    __typename\n  }\n  statusCategory {\n    id\n    statusCategoryId\n    name\n    __typename\n  }\n  __typename\n}\n\nfragment jiraCascadingSelectFieldFragment on JiraCascadingSelectField {\n  id\n  fieldId\n  fieldConfig {\n    isEditable\n    __typename\n  }\n  cascadingOption {\n    parentValue {\n      id\n      isDisabled\n      value\n      __typename\n    }\n    childOptionValue {\n      id\n      optionId\n      isDisabled\n      value\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment jiraProjectFieldFragment on JiraProjectField {\n  fieldId\n  name\n  project {\n    id\n    projectId\n    name\n    key\n    avatar {\n      large\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment ConfluenceLinksFragment on ConfluenceLinks {\n  linkedConfluencePages {\n    pageCount\n    pages {\n      ... on ConfluencePage {\n        id\n        globalId\n        href\n        title\n        type\n        lastUpdatedContext {\n          user {\n            key\n            accountId\n            emailAddress\n            avatarUrl\n            displayName\n            active\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      ... on FailedRemoteLink {\n        id\n        error\n        link {\n          id\n          globalId\n          href\n          __typename\n        }\n        repairLink {\n          href\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n\nfragment DevSummaryFieldFragment on JiraIssueDevSummaryResult {\n  devSummary {\n    commit {\n      overall {\n        count\n        __typename\n      }\n      __typename\n    }\n    pullrequest {\n      overall {\n        state\n        count\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  __typename\n}\n"
            };

            var json = JsonSerializer.Serialize(requestBody);

//            var teste = @$"{{
//	""operationName"": ""JWMListViewItems"",
//	""variables"": {{
//		""cloudId"": ""ca2c7326-90f3-4a94-a85d-58876fad9ab0"",
//		""jql"": ""project = 'DEV' AND (status = \""Em Execução\"" AND assignee = \""712020:fe1eeeb2-6c9d-47a0-9e9a-549caa8dcd26\"") ORDER BY Rank ASC"",
//		""first"": 25,
//		""fieldIds"": [
//			""issuekey"",
//			""issuetype"",
//			""summary"",
//			""status"",
//			""assignee"",
//			""reporter"",
//			""rank"",
//			""parent""
//		],
//		""withConfluenceLinks"": false,
//		""includeDoneItems"": true,
//		""isParentFieldVisible"": false,
//		""isDevSummaryFieldVisible"": false
//	}},
//	""query"": ""query JWMListViewItems($cloudId: ID!, $jql: String!, $includeDoneItems: Boolean!, $fieldIds: [String]!, $first: Int, $after: String, $withConfluenceLinks: Boolean!, $isParentFieldVisible: Boolean!, $isDevSummaryFieldVisible: Boolean!) {{\n  jira {{\n    list: jwmViewItems(cloudId: $cloudId, jql: $jql, first: $first, after: $after) {{\n      ... on QueryError {{\n        message\n        extensions {{\n          statusCode\n          errorType\n          __typename\n        }}\n        __typename\n      }}\n      ... on JiraWorkManagementViewItemConnection {{\n        ...ListViewItemEdges\n        pageInfo {{\n          hasNextPage\n          endCursor\n          __typename\n        }}\n        __typename\n      }}\n      __typename\n    }}\n    __typename\n  }}\n}}\n\nfragment ListViewItemEdges on JiraWorkManagementViewItemConnection {{\n  edges {{\n    node {{\n      id\n      issueId\n      childSummary(includeDone: $includeDoneItems) {{\n        hasChildren\n        totalCount\n        __typename\n      }}\n      commentSummary {{\n        totalCount\n        __typename\n      }}\n      legacyConfluenceLinks(getFirstOnly: true) @include(if: $withConfluenceLinks) {{\n        ...ConfluenceLinksFragment\n        __typename\n      }}\n      devSummaryCache @include(if: $isDevSummaryFieldVisible) {{\n        ...DevSummaryFieldFragment\n        __typename\n      }}\n      ...ListViewIssueFieldsFragment\n      __typename\n    }}\n    __typename\n  }}\n  __typename\n}}\n\nfragment ListViewIssueFieldsFragment on JiraWorkManagementViewItem {{\n  fields: fieldsByIdOrAlias(idsOrAliases: $fieldIds, ignoreMissingFields: true) {{\n    fieldId\n    name\n    aliasFieldId\n    type\n    ... on JiraIssueTypeField {{\n      issueType {{\n        issueTypeId\n        name\n        avatar {{\n          medium\n          __typename\n        }}\n        hierarchy {{\n          level\n          __typename\n        }}\n        __typename\n      }}\n      __typename\n    }}\n    ... on JiraStatusField {{\n      status {{\n        name\n        statusId\n        statusCategory {{\n          statusCategoryId\n          __typename\n        }}\n        __typename\n      }}\n      __typename\n    }}\n    ... on JiraRichTextField {{\n      richText {{\n        adfValue {{\n          json\n          convertedPlainText {{\n            plainText\n            isTruncated\n            __typename\n          }}\n          __typename\n        }}\n        __typename\n      }}\n      renderer\n      __typename\n    }}\n    ... on JiraOriginalTimeEstimateField {{\n      originalEstimate {{\n        timeInSeconds\n        __typename\n      }}\n      fieldConfig {{\n        isEditable\n        __typename\n      }}\n      __typename\n    }}\n    ... on JiraTimeTrackingField {{\n      originalEstimate {{\n        timeInSeconds\n        __typename\n      }}\n      timeTrackingSettings {{\n        defaultUnit\n        defaultFormat\n        workingHoursPerDay\n        workingDaysPerWeek\n        __typename\n      }}\n      __typename\n    }}\n    ... on JiraComponentsField {{\n      fieldConfig {{\n        isEditable\n        __typename\n      }}\n      selectedComponentsConnection {{\n        edges {{\n          node {{\n            name\n            componentId\n            __typename\n          }}\n          __typename\n        }}\n        __typename\n      }}\n      __typename\n    }}\n    ... on JiraParentIssueField {{\n      parentIssue {{\n        issueId\n        key\n        __typename\n      }}\n      __typename\n    }}\n    ... on JiraCheckboxesField {{\n      selectedOptions {{\n        edges {{\n          node {{\n            optionId\n            value\n            __typename\n          }}\n          __typename\n        }}\n        __typename\n      }}\n      __typename\n    }}\n    ... on JiraSprintField {{\n      fieldId\n      aliasFieldId\n      fieldConfig {{\n        isEditable\n        __typename\n      }}\n      selectedSprintsConnection(first: 1) {{\n        edges {{\n          node {{\n            sprintId\n            name\n            state\n            __typename\n          }}\n          __typename\n        }}\n        __typename\n      }}\n      __typename\n    }}\n    ...jiraBusinessSingleVersionFieldFragment\n    ...jiraBusinessMultipleVersionFieldFragment\n    ...jiraBusinessParentFieldFragment\n    ...jiraBusinessTeamFieldFragment\n    ...JiraGoalsFieldFragment\n    ...jiraBusinessResolutionFieldFragment\n    ...jiraBusinessSingleGroupFieldFragment\n    ...jiraBusinessMultipleGroupFieldFragment\n    ...jiraLabelsFieldFragment\n    ...jiraDateFieldFragment\n    ...jiraDateTimeFieldFragment\n    ...jiraSingleUserFieldFragment\n    ...jiraMultipleUserFieldFragment\n    ...jiraPeopleFieldFragment\n    ...jiraPriorityFieldFragment\n    ...jiraMultipleSelectFieldFragment\n    ...jiraNumberFieldFragment\n    ...jiraRadioSelectFieldFragment\n    ...jiraSingleSelectFragment\n    ...jiraUrlFieldFragment\n    ...jiraSingleLineTextFragment\n    ...jiraStatusCategoryFragment\n    ...jiraCascadingSelectFieldFragment\n    ...jiraProjectFieldFragment\n    __typename\n  }}\n  __typename\n}}\n\nfragment jiraBusinessParentFieldFragment on JiraParentIssueField {{\n  fieldId\n  parentIssue {{\n    id\n    issueId\n    key\n    rankField: fieldsByIdOrAlias(idsOrAliases: [\""rank\""], ignoreMissingFields: true) {{\n      aliasFieldId\n      ... on JiraSingleLineTextField {{\n        text\n        __typename\n      }}\n      __typename\n    }}\n    fields: fieldsByIdOrAlias(\n      idsOrAliases: [\""summary\"", \""issuetype\"", \""issuecolor\"", \""status\""]\n      ignoreMissingFields: true\n    ) @include(if: $isParentFieldVisible) {{\n      fieldId\n      name\n      aliasFieldId\n      type\n      ... on JiraColorField {{\n        color {{\n          colorKey\n          __typename\n        }}\n        __typename\n      }}\n      ... on JiraSingleLineTextField {{\n        text\n        __typename\n      }}\n      ... on JiraStatusField {{\n        status {{\n          name\n          statusCategory {{\n            statusCategoryId\n            __typename\n          }}\n          __typename\n        }}\n        __typename\n      }}\n      ... on JiraIssueTypeField {{\n        issueType {{\n          name\n          avatar {{\n            medium\n            __typename\n          }}\n          __typename\n        }}\n        __typename\n      }}\n      __typename\n    }}\n    __typename\n  }}\n  __typename\n}}\n\nfragment jiraBusinessMultipleVersionFieldFragment on JiraMultipleVersionPickerField {{\n  __typename\n  id\n  fieldId\n  name\n  selectedVersionsConnection {{\n    edges {{\n      node {{\n        versionId\n        name\n        __typename\n      }}\n      __typename\n    }}\n    __typename\n  }}\n}}\n\nfragment jiraBusinessSingleVersionFieldFragment on JiraSingleVersionPickerField {{\n  __typename\n  id\n  fieldId\n  name\n  version {{\n    versionId\n    name\n    __typename\n  }}\n}}\n\nfragment jiraBusinessTeamFieldFragment on JiraTeamViewField {{\n  fieldId\n  selectedTeam {{\n    jiraSuppliedName\n    jiraSuppliedTeamId\n    __typename\n  }}\n  __typename\n}}\n\nfragment JiraGoalsFieldFragment on JiraGoalsField {{\n  __typename\n  fieldId\n  name\n  fieldConfig {{\n    isEditable\n    __typename\n  }}\n  selectedGoals(first: 1) {{\n    totalCount\n    edges {{\n      node {{\n        id\n        name\n        status\n        __typename\n      }}\n      __typename\n    }}\n    __typename\n  }}\n}}\n\nfragment jiraBusinessResolutionFieldFragment on JiraResolutionField {{\n  fieldId\n  name\n  resolution {{\n    id\n    name\n    __typename\n  }}\n  __typename\n}}\n\nfragment jiraBusinessMultipleGroupFieldFragment on JiraMultipleGroupPickerField {{\n  __typename\n  id\n  fieldId\n  name\n  selectedGroupsConnection {{\n    edges {{\n      node {{\n        id\n        groupId\n        name\n        __typename\n      }}\n      __typename\n    }}\n    __typename\n  }}\n}}\n\nfragment jiraBusinessSingleGroupFieldFragment on JiraSingleGroupPickerField {{\n  __typename\n  id\n  fieldId\n  name\n  selectedGroup {{\n    id\n    groupId\n    name\n    __typename\n  }}\n}}\n\nfragment jiraLabelsFieldFragment on JiraLabelsField {{\n  selectedLabelsConnection {{\n    edges {{\n      node {{\n        name\n        __typename\n      }}\n      __typename\n    }}\n    __typename\n  }}\n  __typename\n}}\n\nfragment jiraDateFieldFragment on JiraDatePickerField {{\n  date\n  __typename\n}}\n\nfragment jiraDateTimeFieldFragment on JiraDateTimePickerField {{\n  dateTime\n  __typename\n}}\n\nfragment AtlassianAccountFragment on AtlassianAccountUser {{\n  accountId\n  accountStatus\n  picture\n  name\n  __typename\n}}\n\nfragment jiraSingleUserFieldFragment on JiraSingleSelectUserPickerField {{\n  user {{\n    ...AtlassianAccountFragment\n    __typename\n  }}\n  fieldConfig {{\n    isEditable\n    __typename\n  }}\n  __typename\n}}\n\nfragment jiraPeopleFieldFragment on JiraPeopleField {{\n  fieldConfig {{\n    isEditable\n    __typename\n  }}\n  selectedUsersConnection {{\n    edges {{\n      node {{\n        ...AtlassianAccountFragment\n        __typename\n      }}\n      __typename\n    }}\n    __typename\n  }}\n  __typename\n}}\n\nfragment jiraMultipleUserFieldFragment on JiraMultipleSelectUserPickerField {{\n  selectedUsersConnection {{\n    edges {{\n      node {{\n        ...AtlassianAccountFragment\n        __typename\n      }}\n      __typename\n    }}\n    __typename\n  }}\n  fieldConfig {{\n    isEditable\n    __typename\n  }}\n  __typename\n}}\n\nfragment jiraPriorityFieldFragment on JiraPriorityField {{\n  priority {{\n    id\n    name\n    priorityId\n    iconUrl\n    __typename\n  }}\n  __typename\n}}\n\nfragment jiraMultipleSelectFieldFragment on JiraMultipleSelectField {{\n  fieldConfig {{\n    isEditable\n    __typename\n  }}\n  selectedOptions {{\n    edges {{\n      node {{\n        optionId\n        value\n        __typename\n      }}\n      __typename\n    }}\n    __typename\n  }}\n  __typename\n}}\n\nfragment jiraNumberFieldFragment on JiraNumberField {{\n  number\n  fieldConfig {{\n    isEditable\n    __typename\n  }}\n  __typename\n}}\n\nfragment jiraRadioSelectFieldFragment on JiraRadioSelectField {{\n  fieldId\n  name\n  fieldConfig {{\n    isEditable\n    __typename\n  }}\n  selectedOption {{\n    optionId\n    value\n    __typename\n  }}\n  __typename\n}}\n\nfragment jiraSingleSelectFragment on JiraSingleSelectField {{\n  fieldConfig {{\n    isEditable\n    __typename\n  }}\n  fieldOption {{\n    optionId\n    value\n    color {{\n      colorKey\n      __typename\n    }}\n    __typename\n  }}\n  __typename\n}}\n\nfragment jiraUrlFieldFragment on JiraUrlField {{\n  uri\n  fieldConfig {{\n    isEditable\n    __typename\n  }}\n  __typename\n}}\n\nfragment jiraSingleLineTextFragment on JiraSingleLineTextField {{\n  text\n  __typename\n}}\n\nfragment jiraStatusCategoryFragment on JiraStatusCategoryField {{\n  fieldId\n  fieldConfig {{\n    isEditable\n    __typename\n  }}\n  statusCategory {{\n    id\n    statusCategoryId\n    name\n    __typename\n  }}\n  __typename\n}}\n\nfragment jiraCascadingSelectFieldFragment on JiraCascadingSelectField {{\n  id\n  fieldId\n  fieldConfig {{\n    isEditable\n    __typename\n  }}\n  cascadingOption {{\n    parentValue {{\n      id\n      isDisabled\n      value\n      __typename\n    }}\n    childOptionValue {{\n      id\n      optionId\n      isDisabled\n      value\n      __typename\n    }}\n    __typename\n  }}\n  __typename\n}}\n\nfragment jiraProjectFieldFragment on JiraProjectField {{\n  fieldId\n  name\n  project {{\n    id\n    projectId\n    name\n    key\n    avatar {{\n      large\n      __typename\n    }}\n    __typename\n  }}\n  __typename\n}}\n\nfragment ConfluenceLinksFragment on ConfluenceLinks {{\n  linkedConfluencePages {{\n    pageCount\n    pages {{\n      ... on ConfluencePage {{\n        id\n        globalId\n        href\n        title\n        type\n        lastUpdatedContext {{\n          user {{\n            key\n            accountId\n            emailAddress\n            avatarUrl\n            displayName\n            active\n            __typename\n          }}\n          __typename\n        }}\n        __typename\n      }}\n      ... on FailedRemoteLink {{\n        id\n        error\n        link {{\n          id\n          globalId\n          href\n          __typename\n        }}\n        repairLink {{\n          href\n          __typename\n        }}\n        __typename\n      }}\n      __typename\n    }}\n    __typename\n  }}\n  __typename\n}}\n\nfragment DevSummaryFieldFragment on JiraIssueDevSummaryResult {{\n  devSummary {{\n    commit {{\n      overall {{\n        count\n        __typename\n      }}\n      __typename\n    }}\n    pullrequest {{\n      overall {{\n        state\n        count\n        __typename\n      }}\n      __typename\n    }}\n    __typename\n  }}\n  __typename\n}}\n""
//}}";

            var jsonContent = new StringContent(
                //teste,
                json,
                Encoding.UTF8,
                "application/json"
            );

            request.Content = jsonContent;

            Http.DefaultRequestHeaders.Add("Accept", "*/*");
            Http.DefaultRequestHeaders.Add("Accept-Encoding", "gzip, deflate, br, zstd");
            Http.DefaultRequestHeaders.Add("Accept-Language", "pt-BR,pt;q=0.9,en-US;q=0.8");
            Http.DefaultRequestHeaders.Add("apollographql-client-name", "gira");
            Http.DefaultRequestHeaders.Add("Origin", "https://wsys.atlassian.net");
            Http.DefaultRequestHeaders.Add("Referer", "https://wsys.atlassian.net/");
            Http.DefaultRequestHeaders.Add("User-Agent", "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36");
            Http.DefaultRequestHeaders.Add("Cookie", "ajs_anonymous_id=%22c9c7cf0b-df4b-475a-a8b2-a2190e9ad376%22; ajs_anonymous_id=%22c9c7cf0b-df4b-475a-a8b2-a2190e9ad376%22; marketplace-launch-darkly=%7B%22userKey%22%3A%22ea887122-b5e3-4080-8741-b219a6abdf6e%22%2C%22aaid%22%3A%22712020%3Afe1eeeb2-6c9d-47a0-9e9a-549caa8dcd26%22%7D; _issue_in_bifrost=true; atlassian.xsrf.token=1e9d0698850a3271d5fed1691c602139aec328b8_lin; io=HASqI6-w8f2mLe3VBGGp; AWSALB=SBbIwtiuGS8BZ5ewVIm6OQX1+F5V14LJ73SpVDZ20yhTNaT6J9sN8tlnLsw5QHvhu2H6UiqA8s8eJ0XX3cN0ru/zev4/2gFJyaoGzEgZyMvCrmjCN0vg2kS0GyHk; AWSALBCORS=SBbIwtiuGS8BZ5ewVIm6OQX1+F5V14LJ73SpVDZ20yhTNaT6J9sN8tlnLsw5QHvhu2H6UiqA8s8eJ0XX3cN0ru/zev4/2gFJyaoGzEgZyMvCrmjCN0vg2kS0GyHk; tenant.session.token=eyJraWQiOiJzZXNzaW9uLXNlcnZpY2UvcHJvZC0xNTkyODU4Mzk0IiwiYWxnIjoiUlMyNTYifQ.eyJhc3NvY2lhdGlvbnMiOltdLCJzdWIiOiI3MTIwMjA6ZmUxZWVlYjItNmM5ZC00N2EwLTllOWEtNTQ5Y2FhOGRjZDI2IiwiZW1haWxEb21haW4iOiJ3c3lzLmluZi5iciIsImltcGVyc29uYXRpb24iOltdLCJjcmVhdGVkIjoxNzE5OTM4OTMzLCJyZWZyZXNoVGltZW91dCI6MTczNTMxNTM0MywidmVyaWZpZWQiOnRydWUsImlzcyI6InNlc3Npb24tc2VydmljZSIsInNlc3Npb25JZCI6Ijg0ZGExOGEwLTYxZGItNGYxOC1iN2E2LTFlMmU4NzNmODM0OSIsInN0ZXBVcHMiOltdLCJhdWQiOiJhdGxhc3NpYW4iLCJuYmYiOjE3MzUzMTQ3NDMsImV4cCI6MTczNzkwNjc0MywiaWF0IjoxNzM1MzE0NzQzLCJlbWFpbCI6ImFsbGFuLm1lbmV6ZXNAd3N5cy5pbmYuYnIiLCJqdGkiOiI4NGRhMThhMC02MWRiLTRmMTgtYjdhNi0xZTJlODczZjgzNDkifQ.H8dqlrt-zCkLNYYCLrlExYhDo_XldZlQitr6dLuLKj7fgSpQp02VdPTvp8bP8jk3usqQT5ZOBEQO9TlLGuYCfaPH8PKDAzEV_K932n9evi05OzCxIGX2YpC_T2VHoGrdprXk3PiBSdGt81cczi3NrjZ9yOWaNnDAsTFrgSno9UMkLwrDhpYvT8lNRbPvl8GaT3Epl-ta-yntdOs20RDAerO892RXyC2JprOxhrXpl_Uk7jSGfACtG_A6dVFJKfDykCfpAf7NL--pM6L8p0VP-WD1Vr6b8W9KCn06H7KUFZhvROkYJEmJ-zTvO_ifpg2xUjgBo5sCwXdG1HdlPJxj9g; JSESSIONID=5C5FD7F5C5B4E62A84A775CBEA0FC583");
            //request.Headers.Add("Atl-Request-Id", "cf8be704-933a-4b58-ac71-ef3c7500ad0e");
            //request.Headers.Add("Atl-Traceid", "cf8be704933a4b58ac71ef3c7500ad0e");

            var response = await Http.SendAsync(request);
            var responseBody = await response.Content.ReadAsStringAsync();

            //var response = await Http.PostAsync(GetCurrentTaskRoute, jsonContent);
            if (response.IsSuccessStatusCode)
            {
                var responseData = await response.Content.ReadAsStringAsync();
                Console.WriteLine("Resposta: " + responseData);
            }
            else
            {
                Console.WriteLine("Erro: " + response.ReasonPhrase);
            }
        }
        catch (Exception ex)
        {
            var response = $"Erro: {ex.Message}";
        }
    }

    public class RequestBody
    {
        public string OperationName { get; set; }
        public Variables Variables { get; set; }
        public string Query { get; set; }
    }

    public class Variables
    {
        public string CloudId { get; set; }
        public string Jql { get; set; }
        public int First { get; set; }
        public List<string> FieldIds { get; set; }
        public bool WithConfluenceLinks { get; set; }
        public bool IncludeDoneItems { get; set; }
        public bool IsParentFieldVisible { get; set; }
        public bool IsDevSummaryFieldVisible { get; set; }
    }

}
